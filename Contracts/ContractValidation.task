# Contract Validation Engine Implementation

---

## DELEGATION PROMPT

````markdown
**Task**: [Contracts/ContractValidation.task](Contracts/ContractValidation.task)  
**Role**: Implementer (see [Framework/Implementation.prompt.md](../Framework/Implementation.prompt.md))  
**Target Audience**: Implementation Agent (GPT-5.1-Codex-Max)

Implement validation engine to validate context files against discovered contract schemas - checking structure, required fields, and naming patterns.
````

---

## Delegation Prompt

---

## Role: Implementer

**Task File**: Contracts/ContractValidation.task  
**Objective**: Implement validation engine that validates context files against discovered contract schemas

**Role Reference**: See [Framework/Implementation.prompt.md](../Framework/Implementation.prompt.md) for workflow guidance.

### Delegation Context

Contract discovery is complete. Now build the validation engine that takes discovered contracts and validates actual context files against them - checking required sections, required fields, naming conventions, and file structure.

### Responsibilities

1. Design validation result models (success/failure, violation details)
2. Implement schema validation (required sections, required fields)
3. Implement naming convention validation
4. Build comprehensive validation reporting
5. Create unit tests covering all validation scenarios

### Delegation Deliverables

- [ ] **D1**: Validation result models (ValidationResult, Violation, ViolationSeverity)
- [ ] **D2**: Schema validator service (required sections/fields)
- [ ] **D3**: Naming convention validator
- [ ] **D4**: Validation orchestrator combining all validators
- [ ] **D5**: Unit tests covering validation logic (xUnit + Verify)

### Reports

- Keep status/blocker reports in separate `.report` files named `ContractValidation.task.{ReportName}.report` alongside this task file
- Reference the report filenames here (do not inline full reports)
- Move reports together with the task when archiving/moving
- Use [Planning/ProgressReport.report.template](../Planning/ProgressReport.report.template) for status updates and [Planning/BlockerReport.report.template](../Planning/BlockerReport.report.template) when blocked

### Guidance

- Patterns: Use records for validation results, leverage pattern matching for error reporting
- Verification: `dotnet build` and `nuke` succeed; all tests pass
- Critical notes: Validation errors must be actionable - show line numbers, missing fields, specific violations

### Upon Completion

1. Update Progress Log in this file (summaries only; link to `.report` files for details)
2. Use Flow prompt for continue/progress/blocker, and delegate using the 3-line format to the next role
3. When complete, archive to `Contracts/archive/ContractValidation.YYYY-MM-DD.task` and update relevant inventories

---

## Task Details

---

Status: Complete  
Owner: Implementer  
Priority: High  
Effort: Medium

## Objective

Implement the contract validation engine that validates context files (.task, .plan, .convention, etc.) against discovered contract schemas, checking structure, required fields, naming patterns, and producing actionable error reports.

## Task Context

- Current state:
  - ContractMetadata models exist with schema definitions
  - ContractDiscoveryService can find and load contracts
  - No validation logic implemented
  - Need to validate actual files against contract rules
  
- Desired state:
  - ValidationResult models capturing success/failures
  - Schema validator checking required sections/fields
  - Naming validator enforcing conventions
  - Orchestrator service coordinating validators
  - Comprehensive tests covering edge cases

## Task Deliverables

- D1: Models (ValidationResult, Violation record with severity/message/location)
- D2: SchemaValidator service validating required sections/fields against markdown
- D3: NamingValidator checking filename patterns
- D4: ValidationOrchestrator service coordinating all validators
- D5: Unit tests with edge cases (missing sections, malformed fields, invalid names)

## Architecture Decisions

- AD-1: Immutable validation results — Rationale: Thread-safe, composable, easier to test
- AD-2: Location information in violations — Rationale: Users need line numbers to fix issues
- AD-3: Severity levels (Error/Warning/Info) — Rationale: Some rules block, others warn
- AD-4: Strategy pattern for validators — Rationale: Extensible, testable, compose validators
- AD-5: Fail-fast vs collect-all modes — Rationale: CLI can choose based on user preference

## Success Criteria

- [x] `dotnet build` succeeds with 0 errors, 0 warnings
- [ ] `nuke` Compile and Test targets succeed
- [x] All unit tests pass (validation scenarios)
- [ ] Validation results include line numbers and actionable messages
- [ ] Handles malformed markdown gracefully
- [ ] Reports multiple violations per file (not just first)

## Progress Log

- 2024-12-24: Task created after ContractDiscovery completion
- 2025-12-24: Implemented validation engine (models, schema/naming validators, orchestrator) and added unit tests (Contracts.Core.Tests) passing.
- 2024-12-24: **Implementation APPROVED** ✅ (Reviewer role)
  - Review report: [ContractValidation.task.ImplementationReview.report](ContractValidation.task.ImplementationReview.report)
  - All deliverables complete, clean architecture, tests passing (12/12)
  - Ready for CLI integration (xeyth-contracts validate command)

